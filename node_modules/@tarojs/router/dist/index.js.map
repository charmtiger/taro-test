{"version":3,"file":"index.js","sources":["../src/history.ts","../src/stack.ts","../src/api.ts","../src/qs.ts","../src/tabbar.ts","../src/init.ts","../src/router.ts"],"sourcesContent":["import { createBrowserHistory, createHashHistory } from 'history'\n\nexport let history = createBrowserHistory()\n\nexport function setHashHistory () {\n  history = createHashHistory()\n}\n","import { PageInstance } from '@tarojs/runtime'\n\nexport const stacks: PageInstance[] = []\n","import { stacks } from './stack'\nimport { history } from './history'\n\ninterface Option {\n  url: string\n  success?: Function\n  fail?: Function\n  complete?: Function\n}\n\n// TODO: 传递 success, fail, complete\nexport function navigateTo (option: Option) {\n  const { url } = option\n  history.push(url)\n}\n\nexport function redirectTo (option: Option) {\n  const { url } = option\n  history.replace(url)\n}\n\nexport function navigateBack (_: Option) {\n  history.goBack()\n}\n\nexport function switchTab (option: Option) {\n  navigateTo(option)\n}\n\nexport function reLaunch (option: Option) {\n  redirectTo(option)\n}\n\nexport function getCurrentPages () {\n  return stacks\n}\n","export const qs = function () {\n  const params = {}\n\n  location.search.substr(1).split('&').forEach(pair => {\n    const [key, value] = pair.split('=')\n    params[key] = value\n  })\n\n  return params\n}\n","import { AppConfig } from '@tarojs/taro'\n\nexport function initTabbar (config: AppConfig) {\n  if (config.tabBar == null) {\n    return\n  }\n\n  // TODO: 找到 tabbar 的类型\n  const tabbar = document.createElement('taro-tabbar') as any\n  tabbar.conf = config.tabBar\n  const container = document.getElementById('container')\n  // eslint-disable-next-line no-unused-expressions\n  container?.appendChild(tabbar)\n}\n","import { AppConfig } from '@tarojs/taro'\nimport { initTabbar } from './tabbar'\n\nexport function init (config: AppConfig) {\n  // eslint-disable-next-line no-unused-expressions\n  document.getElementById('app')?.remove()\n\n  const container = document.createElement('div')\n  container.classList.add('taro-tabbar__container')\n  container.id = 'container'\n\n  const panel = document.createElement('div')\n  panel.classList.add('taro-tabbar__panel')\n\n  const app = document.createElement('div')\n  app.id = 'app'\n  app.classList.add('taro_router')\n\n  panel.appendChild(app)\n  container.appendChild(panel)\n\n  document.body.appendChild(container)\n\n  initTabbar(config)\n}\n","import UniversalRouter, { Routes } from 'universal-router'\nimport { AppConfig, PageConfig } from '@tarojs/taro'\nimport { LocationListener, LocationState } from 'history'\nimport { createReactApp, createPageConfig, Current, createVueApp, PageInstance, eventCenter } from '@tarojs/runtime'\nimport { qs } from './qs'\nimport { history } from './history'\nimport { stacks } from './stack'\nimport { init } from './init'\n\nexport interface Route extends PageConfig {\n  path: string\n  load: () => Promise<any>\n}\n\nexport interface RouterConfig extends AppConfig {\n  routes: Route[]\n}\n\nfunction addLeadingSlash (path?: string) {\n  if (path == null) {\n    return ''\n  }\n  return path.charAt(0) === '/' ? path : '/' + path\n}\n\nfunction hidePage (page: PageInstance | null) {\n  if (page != null) {\n    page.onHide!()\n    const pageEl = document.getElementById(page.path!)\n    if (pageEl) {\n      pageEl.style.display = 'none'\n    }\n  }\n}\n\nfunction showPage (page: PageInstance | null) {\n  if (page != null) {\n    page.onShow!()\n    stacks.push(page)\n    const pageEl = document.getElementById(page.path!)\n    if (pageEl) {\n      pageEl.style.display = 'block'\n    } else {\n      page.onLoad(qs())\n    }\n  }\n}\n\nfunction unloadPage (page: PageInstance | null) {\n  if (page != null) {\n    page.onHide!()\n    stacks.pop()\n    page.onUnload()\n  }\n}\n\nfunction loadPage (page: PageInstance | null) {\n  if (page !== null) {\n    const pageEl = document.getElementById(page.path!)\n    if (pageEl) {\n      pageEl.style.display = 'block'\n    } else {\n      page.onLoad(qs())\n    }\n    page.onShow!()\n    stacks.push(page)\n  }\n}\n\nexport function createRouter (App, config: RouterConfig, framework: 'react' | 'vue' | 'nerv') {\n  init(config)\n\n  const routes: Routes = []\n\n  for (let i = 0; i < config.routes.length; i++) {\n    const route = config.routes[i]\n    routes.push({\n      path: addLeadingSlash(route.path),\n      action: route.load\n    })\n  }\n\n  const router = new UniversalRouter(routes)\n  const app = framework === 'react' ? createReactApp(App) : createVueApp(App)\n  app.onLaunch()\n\n  const render: LocationListener<LocationState> = async (location, action) => {\n    const element = await router.resolve(location.pathname)\n    const pageConfig = config.routes.find(r => addLeadingSlash(r.path) === location.pathname)\n\n    eventCenter.trigger('__taroRouterChange', {\n      toLocation: {\n        path: location.pathname\n      }\n    })\n\n    if (pageConfig) {\n      document.title = pageConfig.navigationBarTitleText ?? document.title\n    }\n\n    let shouldLoad = false\n\n    if (action === 'POP') {\n      unloadPage(Current.page)\n      const prev = stacks.find(s => s.path === location.pathname)\n      if (prev) {\n        showPage(prev)\n      } else {\n        shouldLoad = true\n      }\n    } else if (action === 'PUSH') {\n      hidePage(Current.page)\n      shouldLoad = true\n    } else if (action === 'REPLACE') {\n      unloadPage(Current.page)\n      shouldLoad = true\n    }\n\n    if (shouldLoad) {\n      const page = createPageConfig(element.default ?? element, location.pathname)\n      loadPage(page)\n    }\n  }\n\n  if (history.location.pathname === '/') {\n    history.replace(config.pages![0])\n  }\n\n  render(history.location, 'PUSH')\n\n  app.onShow!(qs())\n\n  return history.listen(render)\n}\n"],"names":["history","createBrowserHistory","const","let","createReactApp","createVueApp","eventCenter","Current","createPageConfig"],"mappings":"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"}