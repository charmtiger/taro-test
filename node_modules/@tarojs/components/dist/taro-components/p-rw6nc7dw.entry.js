import{r as t,h as s,H as i,g as o}from"./p-fcde3f42.js";import{f as e}from"./p-e4573130.js";const r=class{constructor(s){t(this,s),this.visible=!1,this.isDraggingProgressBall=!1,this.percentage=0,this.progressDimentions={left:0,width:0},this.calcPercentage=t=>{let s=t-this.progressDimentions.left;return s=Math.max(s,0),s=Math.min(s,this.progressDimentions.width),s/this.progressDimentions.width},this.onDragProgressBallStart=()=>{this.isDraggingProgressBall=!0,this.hideControlsTimer&&clearTimeout(this.hideControlsTimer)},this.onClickProgress=t=>{t.stopPropagation();const s=this.calcPercentage(t.pageX);this.seekFunc(s*this.duration),this.toggleVisibility(!0)}}onDocumentTouchMove(t){this.isDraggingProgressBall&&(this.percentage=this.calcPercentage(t.touches[0].pageX),this.setProgressBall(this.percentage),this.setCurrentTime(this.percentage*this.duration))}onDocumentTouchEnd(){this.isDraggingProgressBall&&(this.isDraggingProgressBall=!1,this.seekFunc(this.percentage*this.duration),this.toggleVisibility(!0))}async setProgressBall(t){this.progressBallRef&&(this.progressBallRef.style.left=`${100*t}%`)}async toggleVisibility(t){const s=void 0===t?!this.visible:t;s?(this.hideControlsTimer&&clearTimeout(this.hideControlsTimer),this.isPlaying&&(this.hideControlsTimer=setTimeout(()=>{this.toggleVisibility(!1)},2e3)),this.controlsRef.style.visibility="visible"):this.controlsRef.style.visibility="hidden",this.visible=!!s}async getIsDraggingProgressBall(){return this.isDraggingProgressBall}async setCurrentTime(t){this.currentTimeRef.innerHTML=e(t)}render(){const{controls:t,currentTime:o,duration:r,isPlaying:h,pauseFunc:a,playFunc:n,showPlayBtn:c,showProgress:l}=this,d=e(r);let u;return u=c?s("div",h?{class:"taro-video-control-button taro-video-control-button-pause",onClick:a}:{class:"taro-video-control-button taro-video-control-button-play",onClick:n}):null,s(i,{class:"taro-video-bar taro-video-bar-full"},t&&s("div",{class:"taro-video-controls"},u,l&&s("div",{class:"taro-video-current-time",ref:t=>this.currentTimeRef=t},e(o)),l&&s("div",{class:"taro-video-progress-container",onClick:this.onClickProgress},s("div",{class:"taro-video-progress",ref:t=>{if(!t)return;const s=t.getBoundingClientRect();this.progressDimentions.left=s.left,this.progressDimentions.width=s.width}},s("div",{class:"taro-video-progress-buffered",style:{width:"100%"}}),s("div",{class:"taro-video-ball",ref:t=>this.progressBallRef=t,onTouchStart:this.onDragProgressBallStart,style:{left:`${d?this.currentTime/r*100:0}%`}},s("div",{class:"taro-video-inner"})))),l&&s("div",{class:"taro-video-duration"},d)),s("slot",null))}get controlsRef(){return o(this)}},h=class{constructor(s){t(this,s),this.list=[],this.danmuElList=[],this.currentTime=0,this.enable=!1,this.danmuList=[]}ensureProperties(t){const s=Object.assign({},t);return"time"in t||(s.time=this.currentTime),s.key=Math.random(),s.bottom=`${90*Math.random()+5}%`,s}async sendDanmu(t=[]){this.list=Array.isArray(t)?[...this.list,...t.map(t=>this.ensureProperties(t))]:[...this.list,Object.assign({},this.ensureProperties(t))]}async tick(t){if(this.currentTime=t,!this.enable)return;const s=this.list.filter(({time:s})=>t-s<4&&t>s);let i=!1;const o=this.danmuList;i=s.length!==o.length||s.some(({key:t})=>o.every(s=>t!==s.key)),i&&(this.danmuList=s)}componentDidUpdate(){requestAnimationFrame(()=>{setTimeout(()=>{this.danmuElList.splice(0).forEach(t=>{t.style.left="0",t.style.webkitTransform="translateX(-100%)",t.style.transform="translateX(-100%)"})})})}render(){return this.enable?s(i,{class:"taro-video-danmu"},this.danmuList.map(({text:t,color:i,bottom:o,key:e})=>s("p",{class:"taro-video-danmu-item",key:e,style:{color:i,bottom:o},ref:t=>{t&&this.danmuElList.push(t)}},t))):""}};export{r as taro_video_control,h as taro_video_danmu};