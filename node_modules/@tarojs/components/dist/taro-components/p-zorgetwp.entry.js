import{r as t,h as i,c as e,H as s,g as h}from"./p-fcde3f42.js";import{c as n}from"./p-cff38696.js";import{T as r,L as a}from"./p-d9e48de3.js";function o(t,i){const e=[];for(let s=t;s<=i;s++)e.push(`${s<10?"0":""}${s}`);return e}const c=["20","21","22","23",...o(0,23),"00","01","02","03"],u=["56","57","58","59",...o(0,59),"00","01","02","03"];function l(t,i){return!isNaN(+t)&&t>=0&&t<i.length}function d(t){if(!/^\d{1,2}:\d{1,2}$/.test(t))return!1;const i=t.split(":").map(t=>+t);return!(i[0]<0||i[0]>23||i[1]<0||i[1]>59)}function p(t,i){const e=t.split(":").map(t=>+t),s=i.split(":").map(t=>+t);return e[0]<s[0]||e[0]===s[0]&&e[1]<=s[1]}function g(t){if(!t)return!1;const i=new Date(t.replace(/-/g,"/"));return!isNaN(i.getMonth())&&i}function m(t){let i;return i=Array.isArray(t)?t.map(t=>String(t)):t,i}function f(t,i){const e=[];for(let s=t;s<=i;s++)e.push(s);return e}function _(t,i){return f(t,i)}function k(t,i,e){let s=1,h=12;return t.getFullYear()===e&&(s=t.getMonth()+1),i.getFullYear()===e&&(h=i.getMonth()+1),f(s,h)}function w(t,i,e,s){let h=1,n=function(t,i){return 4===i||6===i||9===i||11===i?30:2===i?t%4==0&&t%100!=0||t%400==0?29:28:31}(e,s);return t.getFullYear()===e&&t.getMonth()+1===s&&(h=t.getDate()),i.getFullYear()===e&&i.getMonth()+1===s&&(n=i.getDate()),f(h,n)}const v=class{constructor(s){t(this,s),this.index=[],this.mode="selector",this.disabled=!1,this.range=[],this.start="",this.end="",this.fields="day",this.name="",this.pickerValue=[],this.height=[],this.hidden=!0,this.fadeOut=!1,this.showPicker=()=>{this.disabled||(this.height=this.getHeightByIndex(),this.hidden=!1)},this.getHeightByIndex=()=>this.index.map(t=>{let i=0;return"time"===this.mode&&(i=4*a),r-a*t-i}),this.hidePicker=()=>{this.fadeOut=!0,setTimeout(()=>{this.hidden=!0,this.fadeOut=!1},350)},this.handleChange=()=>{this.hidePicker(),this.index=this.height.map(t=>(r-t)/a);let t=this.index.length&&"selector"!==this.mode?this.index:this.index[0];if("time"===this.mode){const i=[c.slice(),u.slice()],e=this.index.map((t,e)=>i[e][t]);this.index=e.map(t=>parseInt(t)),t=e.join(":")}if("date"===this.mode){const{_start:i,_end:e,_updateValue:s}=this.pickerDate,h=s[0],n=s[1],r=_(i.getFullYear(),e.getFullYear()),a=k(i,e,h),o=w(i,e,h,n),c=r[this.index[0]],u=a[this.index[1]],l=o[this.index[2]];t="year"===this.fields?[c]:"month"===this.fields?[c,u]:[c,u,l],t=t.join("-")}this.pickerValue=t,this.onChange.emit({value:t})},this.handleCancel=()=>{this.hidePicker(),this.onCancel.emit()},this.updateHeight=(t,i,e=!1)=>{const s=[...this.height];if(s[i]=t,this.height=s,e){let{start:t,end:i}=this;if(d(t)||(t="00:00"),d(i)||(i="23:59"),!p(t,i))return;const e=[c.slice(),u.slice()],s=this.height.map(t=>(r-t)/a).map((t,i)=>e[i][t]).join(":");if(p(t,s)){if(!p(s,i)){const t=i.split(":").map(t=>r-a*(+t+4));requestAnimationFrame(()=>this.height=t)}}else{const i=t.split(":").map(t=>r-a*(+t+4));requestAnimationFrame(()=>this.height=i)}}},this.handleColumnChange=(t,i)=>{this.onColumnChange.emit({column:Number(i),value:(r-t)/a})},this.updateDay=(t,i)=>{const{_start:e,_end:s,_updateValue:h}=this.pickerDate;h[i]=t;const n=h[0],o=h[1],c=h[2];if(0===i){const t=k(e,s,n),i=t[t.length-1],c=t[0];o>i&&(h[1]=i),o<c&&(h[1]=c);const u=t.indexOf(h[1]),l=r-a*u;this.updateDay(h[1],1),this.updateHeight(l,"1")}else if(1===i){const t=w(e,s,n,o),i=t[t.length-1],u=t[0];c>i&&(h[2]=i),c<u&&(h[2]=u);const l=t.indexOf(h[2]),d=r-a*l;this.updateDay(h[2],2),this.updateHeight(d,"2")}},this.getSelector=()=>i("taro-picker-group",{range:this.range,rangeKey:this.rangeKey,height:this.height[0],updateHeight:this.updateHeight,columnId:"0"}),this.getMultiSelector=()=>this.range.map((t,e)=>i("taro-picker-group",{range:t,rangeKey:this.rangeKey,height:this.height[e],updateHeight:this.updateHeight,onColumnChange:this.handleColumnChange,columnId:String(e)})),this.getTimeSelector=()=>{const t=c.slice(),e=u.slice();return[i("taro-picker-group",{mode:"time",range:t,height:this.height[0],updateHeight:this.updateHeight,columnId:"0"}),i("taro-picker-group",{mode:"time",range:e,height:this.height[1],updateHeight:this.updateHeight,columnId:"1"})]},this.getDateSelector=()=>{const{fields:t,height:e}=this,{_start:s,_end:h,_updateValue:n}=this.pickerDate,r=n[0],a=n[1],o=_(s.getFullYear(),h.getFullYear()).map(t=>`${t}年`),c=k(s,h,r).map(t=>`${t}月`),u=w(s,h,r,a).map(t=>`${t}日`),l=[i("taro-picker-group",{mode:"date",range:o,height:e[0],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"0"})];return"month"!==t&&"day"!==t||l.push(i("taro-picker-group",{mode:"date",range:c,height:e[1],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"1"})),"day"===t&&l.push(i("taro-picker-group",{mode:"date",range:u,height:e[2],updateDay:this.updateDay,updateHeight:this.updateHeight,columnId:"2"})),l},this.onChange=e(this,"change",7),this.onColumnChange=e(this,"columnchange",7),this.onCancel=e(this,"cancel",7)}componentWillLoad(){this.handleProps()}componentDidLoad(){Object.defineProperty(this.el,"value",{get:()=>this.pickerValue,set:t=>this.value=t,configurable:!0})}onPropsChange(){this.handleProps()}handleProps(){const{mode:t,start:i,end:e}=this;if("selector"===t){const t=this.value;this.index=[l(t,this.range)?Math.floor(t):0]}else if("multiSelector"===t){const t=this.value;this.index=[],this.range.forEach((i,e)=>{var s;const h=null===(s=t)||void 0===s?void 0:s[e],n=l(h,i)?Math.floor(h):0;this.index.push(n)})}else if("time"===t){let t=this.value;d(t)||(console.warn("time picker value illegal"),t="0:0");const i=t.split(":").map(t=>+t);this.index=i}else if("date"===t){const t=g(this.value)||new Date((new Date).setHours(0,0,0,0)),s=g(i)||new Date("1970/01/01"),h=g(e)||new Date("2999/01/01");if(!(t>=s&&t<=h))throw new Error("Date Interval Error");{const i=t.getFullYear(),e=t.getMonth()+1,n=t.getDate(),r=_(s.getFullYear(),h.getFullYear()),a=k(s,h,i),o=w(s,h,i,e);this.index=[r.indexOf(i),a.indexOf(e),o.indexOf(n)],this.pickerDate&&this.pickerDate._value.getTime()===t.getTime()&&this.pickerDate._start.getTime()===s.getTime()&&this.pickerDate._end.getTime()===h.getTime()||(this.pickerDate={_value:t,_start:s,_end:h,_updateValue:[i,e,n]})}}this.height=this.getHeightByIndex(),this.pickerValue=this.value}render(){const{name:t,mode:e,fadeOut:h,hidden:r}=this;let a;switch(e){case"multiSelector":a=this.getMultiSelector();break;case"time":a=this.getTimeSelector();break;case"date":a=this.getDateSelector();break;default:a=this.getSelector()}const o=n("weui-mask","weui-animate-fade-in",{"weui-animate-fade-out":h}),c=n("weui-picker","weui-animate-slide-up",{"weui-animate-slide-down":h}),u=r?{display:"none"}:{};return i(s,null,i("div",{onClick:this.showPicker},i("slot",null)),i("div",{style:u,class:o,onClick:this.handleCancel}),i("div",{style:u,class:c},i("div",{class:"weui-picker__hd"},i("div",{class:"weui-picker__action",onClick:this.handleCancel},"取消"),i("div",{class:"weui-picker__action",onClick:this.handleChange},"确定")),i("div",{class:"weui-picker__bd"},a),i("input",{type:"hidden",name:t,value:m(this.pickerValue)})))}get el(){return h(this)}static get watchers(){return{mode:["onPropsChange"],value:["onPropsChange"],range:["onPropsChange"],start:["onPropsChange"],end:["onPropsChange"]}}static get style(){return".weui-picker,.weui-picker__hd{font-size:12px}"}};export{v as taro_picker_core};